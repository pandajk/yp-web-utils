'use strict';Object.defineProperty(exports,'__esModule',{value:true});var promiseLimit=require('promise-limit');function ImagePreloader(src,options){var _this=this;options=Object.assign({prefix:'',suffix:''},options);switch(Object.prototype.toString.call(src)){case'[object Array]':this.src=src;src.map(function(el){if(_this.buffer.indexOf(el)<0){_this.buffer.push(el)}});break;case'[object String]':this.src=options.prefix+src+options.suffix;if(this.buffer.indexOf(src)<0){this.buffer.push(src)}break;}}ImagePreloader.prototype.buffer=[];ImagePreloader.prototype.loadImage=function loadImage(){var image=this.onload(this.src);return image};ImagePreloader.prototype.loadImages=function loadImage(){var _this2=this;var limit=promiseLimit(5);var images=this.src.map(function(el){return limit(function(){_this2.onload(el)})});return Promise.all(images)};ImagePreloader.prototype.onload=function onload(src){return new Promise(function(resolve,reject){if(!/.(png|jpg|jpeg|webp)/.test(src)){reject('It is not an image, or format not support.');return}var retry=0;var image=new Image;image.onload=function(){resolve({width:image.width,height:image.height,src:image.src})};image.onerror=function(){retry+=1;if(retry>3){reject('image load error')}else{image.src=src}console.log('onerror')};if(!/(dev-)?res.yopoint./.test(src)){reject('image domain is illegal')}else{image.src=src}})};exports.default=ImagePreloader;